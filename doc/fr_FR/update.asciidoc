= Mise à jour

== Centre de mise à jour

Le centre de mise à jour centralise l'ensemble des fonctions de Jeedom et permet de mettre à jour toutes les fonctionnalités de Jeedom, incluant le logiciel de base, les plugins, les widgets, etc.

Il est accessible par le menu Général -> Administration -> Centre de mise à jour : 

image::../images/update.JPG[]

Une fois dessus, vous obtenez : 

image::../images/update2.png[]

Il présente sous forme de tableau l'ensemble des éléments installés dans Jeedom.

[TIP]
En mode Expert, on affiche tous les élements, sinon, on affiche uniquement les éléments à mettre à jour.


Il y a au total jusqu'à 5 boutons qui peuvent être disponibles par élément :

* *Changelog* : permet de consulter le journal des modifications.
* *Voir* : permet de consulter la page du market correspondant à l'élément sélectionné.
* *Partager* : permet lorsque vous avez créé un élément de le partager sur le market.
* *Supprimer* : permet de désinstaller un élément.
* *Mettre à jour* : permet de mettre à jour l'élément.

[TIP]
A noter que "Core" Jeedom signifie la mise à jour du logiciel de base Jeedom.


En haut du tableau se trouvent les boutons de commande. Jeedom se connecte quotidiennement au market pour voir si des mises à jour sont disponibles (la date de dernière vérification est indiquée tout en haut du tableau à gauche). Si vous voulez réaliser une vérification manuelle, vous pouvez appuyer sur le bouton "Vérifier les mises à jour".

Le bouton "Mettre à jour" permet de mettre à jour l'ensemble de Jeedom.

image::../images/update3.png[]

[TIP]
Sur la branche bêta, le numéro de version n'est pas toujours mis à jour après chaque modification, il faut donc cliquer sur "Mettre à jour" régulièrement pour être sûr d'avoir la dernière version. Ce n'est le cas bien sûr que sur la branche bêta.

[IMPORTANT]
Avant une mise à jour, Jeedom va par défaut faire une sauvegarde. En cas de souci lors de l'application d'une mise à jour, Jeedom va automatiquement restaurer la sauvegarde faite juste avant. Ce principe n'est bien sur valable que pour les mises à jour de Jeedom et non des plugins.

En cliquant sur la flèche à côté du bouton "Mettre à jour", on a un certain nombre d'options de mise à jour.

image::../images/update5.png[]

* *Tout forcer* : Met à jour Jeedom et les plugin en mode forcé, c'est a dire que même s'il y a une erreur, Jeedom continue et ne restaurera pas la sauvegarde
* *Plugins seulement* : Met à jour seulement les plugins
* *Plugins seulement forcés* : Met à jour seulement les plugins en mode forcé (continue en cas d'erreur)
* *Jeedom seulement* : Met à jour seulement Jeedom
* *Jeedom seulement forcés* : Met à jour seulement Jeedom en mode forcé, c'est a dire que même s'il y a une erreur, Jeedom continue et ne restaurera pas la sauvegarde
* *Réappliquer une mise à jour* : Permet de réappliquer une mise à jour. Toute les mises à jour ne peuvent etre réappliquées. En cliquant dessus, vous obtenez cette fenêtre : 

image::../images/update6.png[]

Ici, vous choisissez d'abord la mise à jour a réappliquer, si c'est en mode forcé ou non (vivement conseillé dans ce cas-là) et s'il faut aussi appliquer les mise à jour suivantes (vivement conseillé aussi).

Enfin, à droite de la page, la partie "Informations" permet de suivre l'avancement de la mise à jour.
Ces informations sont à communiquer à l'équipe en cas de problème.

image::../images/update4.png[]

== Paramètres de mise à jour

Il est possible dans Général -> Administration -> Configuration puis dans la partie "Market et mise à jour" de configurer certains paramètres de mise à jour :

image::../images/update7.png[]

Ici on retrouve : 

* *Addresse* : Addresse du market, à ne surtout jamais changer à moins que ça ne soit sur demande de l'équipe support
* *Nom d'utilisateur* : nom d'utilisateur du market
* *Mot de passe* : mot de passe du market
* *Installer automatiquement les widgets manquants* : indique à Jeedom d'installer automatiquement les widgets dont il a besoin (attention à bien avoir installé le plugin widget)
* *Voir les modules en beta (à vos risques et périls)* : Permet de voir les plugins, widgets... qui sont en bêta et de les installer
* *Faire une sauvegarde avant la mise à jour* : indique a jeedom de faire une sauvegarde avant chaque mise à jour (vivement recommandé)
* *Mettre à jour automatiquement* : Indique à Jeedom d'installer automatiquement les mises à jour (non recommandé)
* *Branche* : Indique la version de Jeedom à utiliser soit la stable soit la développement (bêta)

[IMPORTANT]
Il faut éviter de mélanger les plugins bêta avec un Jeedom stable et vise versa. De nombreuses erreurs sont remontées à l'équipe de support car cette régle n'est pas respectée.

[IMPORTANT]
Il n'est pas possible de choisir l'heure de la verification des mises à jour, ou le moment de la mise à jour en automatique, cela pour permettre une répartition des demandes sur le market. A noter toutefois ques ces deux actions ont forcément lieu entre 6h00 et 7h59.

== Mise à jour en ligne de commande

Il est possible de faire une mise à jour de Jeedom directement en SSH, voila comment faire : 

----
sudo php /usr/share/nginx/www/jeedom/install/install.php
----

Voila les paramètres possible :

* *mode* : force pour lancer une mise à jour en mode forcé (ne tiens pas compte des erreurs)
* *version* : numéro de version, pour réapliquer les changements depuis cette version

Exemple pour faire une mise à jour forcé en réapliquant les changements depuis la 1.188.0 : 

----
sudo php /usr/share/nginx/www/jeedom/install/install.php mode=force version=1.188.0
----

Attention après une mise à jour en ligne de commande il faut réapliquer les droits sur le dossier jeedom :

----
chown -R www-data:www-data /usr/share/nginx/www/jeedom
----
