<div class="cmd cmd-widget widget-rain #history#" data-type="info" data-subtype="numeric" data-template="rain" data-cmd_id="#id#" data-cmd_uid="#uid#" data-version="#version#" data-eqLogic_id="#eqLogic_id#">
  <div class="widget-rain-main">
    <div class="widget-rain-container">
      <div class="widget-rain-title">
        <span class="#hide_name#">#name_display#</span><br/>
        <span class="value widget-rain-title-value"></span>
        <span class="unite">#unite#</span>
        <span class="plage"></span>
      </div>
    </div>
    <div class="widget-rain-water" style=""></div>
  </div>
  <div class="cmdStats #hide_history#">
    <div class="col-xs-12 center-block">
      <span title='Min' class='tooltips'>#minHistoryValue#</span>|<span title='Moyenne' class='tooltips'>#averageHistoryValue#</span>|<span title='Max' class='tooltips'>#maxHistoryValue#</span> <i class="#tendance#"></i>
    </div>
  </div>
  <script>
    var scale#id# = ('#scale#' !='#'+'scale#') ? parseFloat('#scale#') : 1;
    $('.cmd[data-cmd_id=#id#] .widget-rain-water').css('max-height',(45*scale#id#)+'px')
    jeedom.cmd.update['#id#'] = function(_options){
      var value = parseFloat(_options.display_value);
      var valMini,bMini;
      if('#valMini#' !='#'+'valMini#') valMini = bMini = parseFloat('#valMini#');
      else { valMini = 0; bMini = '-' }
      var valMaxi,bMaxi;
      if('#valMaxi#' !='#'+'valMaxi#') valMaxi =bMaxi = parseFloat('#valMaxi#');
      else { valMaxi = 20; bMaxi = '-' }
      var scaledValue = (value-valMini)*35*scale#id#/(valMaxi-valMini);
      let cmd = $('.cmd[data-cmd_id=#id#]');
      cmd.attr('title','Date de valeur : '+_options.valueDate+'<br/>Date de collecte : '+_options.collectDate+'<br/>Valeur : '+value+'#unite#')
      cmd.find('.value').empty().append(value);
      cmd.find('.plage').empty().append('('+bMini+'/'+bMaxi+')');
      if(bMini != '-' || bMaxi != '-') cmd.find('.plage').empty().append('('+bMini+'/'+bMaxi+')');
      else cmd.find('.plage').empty();
      cmd.find('.widget-rain-water').delay(0).animate({height:(scaledValue)+"pt"},1000)
      if(value > valMaxi)
        $('.cmd[data-cmd_id=#id#] .widget-rain-title-value').css('color','red')
      else if(value < valMini)
        $('.cmd[data-cmd_id=#id#] .widget-rain-title-value').css('color','cyan')
      else {
        var col = $('.cmd[data-cmd_id=#id#] .plage').css('color')
        $('.cmd[data-cmd_id=#id#] .widget-rain-title-value').css('color','var(--link-color)')
      }
    }
    if(scale#id# != 1) {
      let el = $('.cmd[data-cmd_id=#id#] .widget-rain-main');
      el.width(el.width() * scale#id#);
      el.height(el.height() * scale#id#)
    }
    if ('#animate#' == '0') {
      $('.cmd[data-cmd_id=#id#] .widget-rain-water').css('animation','none')
    }
    jeedom.cmd.update['#id#']({display_value:'#state#',valueDate:'#valueDate#',collectDate:'#collectDate#',alertLevel:'#alertLevel#'});
  </script>
</div>
